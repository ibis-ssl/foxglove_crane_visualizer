# è¨­å®šã‚¬ã‚¤ãƒ‰

## ğŸ›ï¸ è¨­å®šãƒ‘ãƒãƒ«æ¦‚è¦

Crane Visualizerãƒ‘ãƒãƒ«ã®è¨­å®šã¯ã€è«–ç†çš„ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸ4ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ç‰¹å®šã®æ©Ÿèƒ½é ˜åŸŸã‚’ç®¡ç†ã—ã€åŠ¹ç‡çš„ãªè¨­å®šå¤‰æ›´ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

## ğŸ“¡ ãƒˆãƒ”ãƒƒã‚¯è¨­å®š

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒˆãƒ”ãƒƒã‚¯
- **è¨­å®šé …ç›®**: `aggregatedTopic`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `/aggregated_svgs`
- **èª¬æ˜**: å®Œå…¨ãªçŠ¶æ…‹æƒ…å ±ã‚’å«ã‚€ä½é »åº¦ãƒˆãƒ”ãƒƒã‚¯
- **æ¨å¥¨å€¤**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ROSãƒˆãƒ”ãƒƒã‚¯å‘½åè¦å‰‡ã«å¾“ã£ã¦è¨­å®š

```yaml
# ä¾‹: ãƒãƒ¼ãƒ åˆ¥è¨­å®š
aggregatedTopic: "/team_blue/aggregated_svgs"
aggregatedTopic: "/simulation/field_state"
aggregatedTopic: "/match_recorder/full_state"
```

### æ›´æ–°ãƒˆãƒ”ãƒƒã‚¯
- **è¨­å®šé …ç›®**: `updateTopic`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `/visualizer_svgs`
- **èª¬æ˜**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã®å¢—åˆ†æ›´æ–°ã‚’å«ã‚€é«˜é »åº¦ãƒˆãƒ”ãƒƒã‚¯
- **æ¨å¥¨å€¤**: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒˆãƒ”ãƒƒã‚¯ã¨æ•´åˆæ€§ã‚’ä¿ã¤å‘½å

```yaml
# ä¾‹: å¯¾å¿œã™ã‚‹æ›´æ–°ãƒˆãƒ”ãƒƒã‚¯
updateTopic: "/team_blue/svg_updates"
updateTopic: "/simulation/dynamic_updates"
updateTopic: "/match_recorder/incremental_updates"
```

### æ›´æ–°ãƒˆãƒ”ãƒƒã‚¯æœ‰åŠ¹åŒ–
- **è¨­å®šé …ç›®**: `enableUpdateTopic`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `true`
- **èª¬æ˜**: æ›´æ–°ãƒˆãƒ”ãƒƒã‚¯ã®ä½¿ç”¨å¯å¦ã‚’åˆ¶å¾¡

#### æœ‰åŠ¹æ™‚ (`true`) - æ¨å¥¨è¨­å®š
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ + æ›´æ–°ã®çµ±åˆå‡¦ç†
- æœ€å¤§90%ã®ãƒ­ã‚°ã‚µã‚¤ã‚ºå‰Šæ¸›
- é«˜ç²¾åº¦ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

#### ç„¡åŠ¹æ™‚ (`false`) - ãƒ¬ã‚¬ã‚·ãƒ¼äº’æ›
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒˆãƒ”ãƒƒã‚¯ã®ã¿ä½¿ç”¨
- å¾“æ¥ã®Foxgloveæ‹¡å¼µã¨åŒç­‰ã®å‹•ä½œ
- ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šã§ã®ãƒ†ã‚¹ãƒˆç”¨é€”

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š

### å±¥æ­´ä¿æŒæœŸé–“
- **è¨­å®šé …ç›®**: `maxHistoryDuration`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `300ç§’`ï¼ˆ5åˆ†é–“ï¼‰
- **å˜ä½**: ç§’
- **èª¬æ˜**: ãƒ¡ãƒ¢ãƒªã«ä¿æŒã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€å¤§æœŸé–“

#### ç”¨é€”åˆ¥æ¨å¥¨å€¤
```json
{
  "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æ": 60,     // 1åˆ†é–“
  "çŸ­æœŸæˆ¦è¡“åˆ†æ": 300,       // 5åˆ†é–“  
  "è©¦åˆå…¨ä½“ãƒ¬ãƒ“ãƒ¥ãƒ¼": 1800,   // 30åˆ†é–“
  "é•·æœŸé–“ãƒ‡ãƒ¼ã‚¿åˆ†æ": 7200    // 2æ™‚é–“
}
```

#### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›®å®‰
```
60ç§’è¨­å®š:   ç´„50MB
300ç§’è¨­å®š:  ç´„250MB
1800ç§’è¨­å®š: ç´„1.5GB
7200ç§’è¨­å®š: ç´„6GB
```

### æœ€å¤§å±¥æ­´ã‚µã‚¤ã‚º
- **è¨­å®šé …ç›®**: `maxHistorySize`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `1000ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`
- **èª¬æ˜**: ä¿æŒã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€å¤§æ•°ï¼ˆæœŸé–“åˆ¶é™ã®è£œå®Œï¼‰

#### è¨­å®šã®è€ƒãˆæ–¹
```typescript
// å®Ÿéš›ã®åˆ¶é™ = min(maxHistoryDuration, maxHistorySize)
// ä¾‹: 30Hzã®æ›´æ–°ãƒˆãƒ”ãƒƒã‚¯ã®å ´åˆ
const messagesIn5Minutes = 30 * 60 * 5; // 9000ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
// maxHistorySize: 1000 â†’ å®Ÿéš›ã¯ç´„33ç§’åˆ†ã®ã¿ä¿æŒ
```

#### æ¨å¥¨è¨­å®šå€¤
```json
{
  "ä½ãƒ¡ãƒ¢ãƒªç’°å¢ƒ": 500,
  "æ¨™æº–ç’°å¢ƒ": 1000,
  "é«˜æ€§èƒ½ç’°å¢ƒ": 5000,
  "ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒ": 10000
}
```

## ğŸ¨ è¡¨ç¤ºè¨­å®š

### èƒŒæ™¯è‰²
- **è¨­å®šé …ç›®**: `backgroundColor`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `#585858ff`
- **å½¢å¼**: RGBAè‰²æŒ‡å®š
- **èª¬æ˜**: SVGã‚­ãƒ£ãƒ³ãƒã‚¹ã®èƒŒæ™¯è‰²

#### è‰²æŒ‡å®šã®è©³ç´°
```css
/* 16é€²æ•°RGBAè¡¨è¨˜ */
#585858ff /* ã‚°ãƒ¬ãƒ¼ã€ä¸é€æ˜ */
#000000ff /* é»’ã€ä¸é€æ˜ */
#ffffffcc /* ç™½ã€åŠé€æ˜ */
#00ff0080 /* ç·‘ã€50%é€æ˜ */
```

#### ç”¨é€”åˆ¥æ¨å¥¨è‰²
```json
{
  "ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¡¨ç¤º": "#228b22ff",    // ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚°ãƒªãƒ¼ãƒ³
  "æŠ€è¡“åˆ†æ": "#000000ff",         // é»’
  "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³": "#ffffffff", // ç™½
  "ãƒ‡ãƒãƒƒã‚°": "#404040ff"          // ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼
}
```

### ViewBoxå¹…
- **è¨­å®šé …ç›®**: `viewBoxWidth`
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**: `10000`
- **å˜ä½**: åº§æ¨™å˜ä½ï¼ˆé€šå¸¸ã¯mmï¼‰
- **èª¬æ˜**: è¡¨ç¤ºç¯„å›²ã®å¹…ï¼ˆã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã«å½±éŸ¿ï¼‰

#### SSLæ¨™æº–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚µã‚¤ã‚ºå¯¾å¿œ
```json
{
  "ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¨ä½“": 12000,    // 12må¹…
  "ãƒãƒ¼ãƒ•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰": 6000,   // 6må¹…  
  "ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚¨ãƒªã‚¢": 2400,   // 2.4må¹…
  "è©³ç´°åˆ†æ": 1000           // 1må¹…
}
```

#### ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®è‡ªå‹•èª¿æ•´
```typescript
// é«˜ã•ã¯å¹…ã®60%ã§è‡ªå‹•è¨ˆç®—
const height = viewBoxWidth * 0.6;
const viewBox = `${-viewBoxWidth/2} ${-height/2} ${viewBoxWidth} ${height}`;
```

## ğŸ“ åå‰ç©ºé–“ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºåˆ¶å¾¡ï¼‰

### éšå±¤æ§‹é€ ã®ç®¡ç†
ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯éšå±¤çš„ãªåå‰ç©ºé–“ã§ç®¡ç†ã•ã‚Œã€å€‹åˆ¥ã«è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚

```
field/                    âœ“ è¡¨ç¤º
â”œâ”€ boundary              âœ“ è¡¨ç¤º
â”œâ”€ goals                 âœ“ è¡¨ç¤º
â””â”€ center_circle         âœ— éè¡¨ç¤º

robots/                   âœ“ è¡¨ç¤º
â”œâ”€ team_blue/            âœ“ è¡¨ç¤º
â”‚  â”œâ”€ robot_0           âœ“ è¡¨ç¤º
â”‚  â””â”€ robot_1           âœ— éè¡¨ç¤º
â””â”€ team_yellow/          âœ— éè¡¨ç¤º

debug/                    âœ— éè¡¨ç¤º
â”œâ”€ trajectories          - è¦ªãŒéè¡¨ç¤º
â””â”€ ai_decisions          - è¦ªãŒéè¡¨ç¤º
```

### å‹•çš„ãƒ¬ã‚¤ãƒ¤ãƒ¼ç™ºè¦‹
æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå«ã¾ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«è¨­å®šé …ç›®ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

```typescript
// æ–°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è‡ªå‹•è¿½åŠ 
msg.svg_primitive_arrays.forEach((svg_primitive_array) => {
  if (!config.namespaces[svg_primitive_array.layer]) {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤ºçŠ¶æ…‹ã§è¿½åŠ 
    newNamespaces[svg_primitive_array.layer] = { visible: true };
  }
});
```

## ğŸ”§ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†

### è¨­å®šã®æ°¸ç¶šåŒ–
Foxglove StudioãŒãƒ‘ãƒãƒ«è¨­å®šã‚’è‡ªå‹•çš„ã«ä¿å­˜ãƒ»å¾©å…ƒã—ã¾ã™ã€‚

```json
// ä¿å­˜ã•ã‚Œã‚‹è¨­å®šä¾‹
{
  "backgroundColor": "#585858ff",
  "viewBoxWidth": 10000,
  "aggregatedTopic": "/aggregated_svgs",
  "updateTopic": "/visualizer_svgs", 
  "enableUpdateTopic": true,
  "maxHistoryDuration": 300,
  "maxHistorySize": 1000,
  "namespaces": {
    "field/boundary": { "visible": true },
    "robots/team_blue/robot_0": { "visible": true },
    "debug/trajectories": { "visible": false }
  }
}
```

### è¨­å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
Foxglove Studioã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦è¨­å®šã‚’ä¿å­˜ãƒ»å…±æœ‰ã§ãã¾ã™ã€‚

## ğŸ“Š è¨­å®šç›£è¦–ã¨ãƒ‡ãƒãƒƒã‚°

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±è¡¨ç¤º
ãƒ‘ãƒãƒ«ä¸‹éƒ¨ã«è¨­å®šã®å‹•ä½œçŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
Aggregated Topic: /aggregated_svgs
Update Topic: /visualizer_svgs
Receive num: 1250
History: Aggregated(25), Updates(750)
Seek Time: 2024-01-15T10:30:45.123Z
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
- **Receive num**: å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·æ•°
- **History counts**: å„ãƒˆãƒ”ãƒƒã‚¯ã®å±¥æ­´ä¿æŒæ•°
- **Seek Time**: ç¾åœ¨ã®æ™‚é–“ã‚·ãƒ¼ã‚¯ä½ç½®

## ğŸš€ é«˜åº¦ãªè¨­å®šãƒ‘ã‚¿ãƒ¼ãƒ³

### é–‹ç™ºç’°å¢ƒè¨­å®š
```json
{
  "aggregatedTopic": "/dev/aggregated_svgs",
  "updateTopic": "/dev/svg_updates",
  "enableUpdateTopic": true,
  "maxHistoryDuration": 60,
  "maxHistorySize": 500,
  "backgroundColor": "#404040ff",
  "viewBoxWidth": 8000
}
```

### æœ¬ç•ªç’°å¢ƒè¨­å®š
```json
{
  "aggregatedTopic": "/match/field_state",
  "updateTopic": "/match/updates",
  "enableUpdateTopic": true,
  "maxHistoryDuration": 1800,
  "maxHistorySize": 5000,
  "backgroundColor": "#228b22ff",
  "viewBoxWidth": 12000
}
```

### ãƒ‡ãƒ¢ãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
```json
{
  "aggregatedTopic": "/demo/visualization",
  "updateTopic": "/demo/highlights",
  "enableUpdateTopic": true,
  "maxHistoryDuration": 300,
  "maxHistorySize": 1000,
  "backgroundColor": "#ffffffff",
  "viewBoxWidth": 10000
}
```

## ğŸ’¡ è¨­å®šã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. æ®µéšçš„ãªè¨­å®šå¤‰æ›´
å¤§ããªå¤‰æ›´ã¯æ®µéšçš„ã«è¡Œã„ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§å‹•ä½œç¢ºèªã‚’å®Ÿæ–½

### 2. ç’°å¢ƒåˆ¥è¨­å®šç®¡ç†
é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»æœ¬ç•ªã§ç•°ãªã‚‹è¨­å®šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¶­æŒ

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¨å¿œç­”æ€§èƒ½ã‚’å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯

### 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
é‡è¦ãªè¨­å®šã¯Foxglove Studioã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã§ä¿å­˜

### 5. ãƒãƒ¼ãƒ å…±æœ‰
ãƒãƒ¼ãƒ å†…ã§æ¨™æº–çš„ãªè¨­å®šã‚’å…±æœ‰ã—ã€ä¸€è²«ã—ãŸåˆ†æç’°å¢ƒã‚’æ§‹ç¯‰

ã“ã®åŒ…æ‹¬çš„ãªè¨­å®šã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Šã€æ§˜ã€…ãªç”¨é€”ã¨ç’°å¢ƒã«å¿œã˜ãŸCrane Visualizerãƒ‘ãƒãƒ«ã®æœ€é©åŒ–ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚